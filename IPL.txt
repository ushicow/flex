*
* IPL FOR THE MILL FLEX
*
	.OR $7700
	.TF IPL

RWTS	.EQ $77B5	APPLE DOS RWTB
IOB	.EQ $77E8	APPLE DOS IOB
CURDRV	.EQ IOB+2
VOLREG	.EQ IOB+3
TRKREG	.EQ IOB+4
SECREG	.EQ IOB+5
SECBUF	.EQ IOB+8
NUMBUF	.EQ IOB+$B
COMREG	.EQ IOB+$C
RETCODE	.EQ IOB+$D
BIOS	.EQ $6000	BIOS START ADDRESS

	LDA #1		READ COMMAND
	STA CURDRV
	STA COMREG
	LDA #0
	STA VOLREG
	STA TRKREG
	STA SECBUF	SECTOR BUFFER ADDRESS IS $xx00

	LDA #$A		SECTOR A: MILLBIOS
	STA SECREG
	LDA #BIOS/256	  READ TO BIOS START ADDRESS
	STA SECBUF+1
	JSR RDSEC
	
	LDA #$B		SECTOR B: DRIVER
	STA SECREG
	LDA #$5E	  READ TO $5E00 (6809 $DE00)
	STA SECBUF+1
	JSR RDSEC

	LDA #$C		SECTOR C: CONSOLE
	STA SECREG
	LDA #$53	  READ TO $5300 (6809 $D300)
	STA SECBUF+1
	JSR RDSEC

	LDA #$D		SECTOR D: FLEXLOAD
	STA SECREG
	LDA #BIOS/256+1	  READ TO BIOS + $100
	STA SECBUF+1
	JSR RDSEC

	LDA #$E		SECTOR E: TESTUTIL
	STA SECREG
	LDA #BIOS/256+2	  READ TO BIOS + $200
	STA SECBUF+1
	JSR RDSEC

	LDA #$F		SECTOR F:
	STA SECREG
	LDA #BIOS/256+3	  READ TO BIOS + $300
	STA SECBUF+1
	JSR RDSEC

	LDA #$1		TRACK 1 / SECTOR 0 FLEXLOAD
	STA TRKREG
	LDA #$0
	STA SECREG
	LDA #$41	  READ TO $4100 (6809 $C100)
	STA SECBUF+1
	JSR RDSEC

	JMP BIOS

RDSEC	LDA #IOB/256	READ A SECTOR
	LDY #IOB
	JMP RWTS

	.EN
